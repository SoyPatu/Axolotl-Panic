<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AXOLOTL PANIC - DELUXE EDITION</title>
  <style>
    /* Colores pastel */
    :root {
      --rosa: #ee4cb7;
      --cian: #6be5f6;
      --amarillo: #f9f86a;
      --rosa-claro: #ffe4f5;
      --morado-claro: #d8b8ff;
      --gris: #cccccc;
      --azul-claro: #a0e7ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }

    body {
      background: linear-gradient(to bottom, #1a1a2e, #16213e);
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      transition: all 0.5s ease;
      opacity: 0;
      transform: scale(0.95);
    }

    .container.active {
      opacity: 1;
      transform: scale(1);
    }

    h1, h2, h3 {
      text-align: center;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 3rem;
      color: var(--rosa);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    button {
      background: var(--cian);
      color: #000;
      border: none;
      padding: 15px 30px;
      margin: 10px;
      border-radius: 15px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      background: var(--amarillo);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-rosa { background: var(--rosa); color: white; }
    .btn-amarillo { background: var(--amarillo); color: #000; }

    /* Pantallas */
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .screen.active {
      display: flex;
    }

    /* Menú Principal */
    #menu-screen .logo {
      width: 300px;
      margin-bottom: 20px;
    }

    #menu-screen button {
      width: 300px;
      font-size: 1.5rem;
    }

    /* Gameplay */
    #gameplay-screen {
      display: grid;
      grid-template-rows: auto auto 1fr auto auto;
      gap: 15px;
      height: 100vh;
      padding: 10px;
    }

    .player-info {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }

    .player-box {
      background: var(--rosa-claro);
      color: #000;
      padding: 12px;
      border-radius: 12px;
      width: 22%;
      min-width: 180px;
      text-align: center;
      border: 4px solid transparent;
      transition: all 0.3s;
    }

    .player-box.human { background: var(--rosa-claro); }
    .player-box.bot { background: var(--morado-claro); }
    .player-box.current-turn {
      border: 4px solid var(--rosa);
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--rosa);
    }

    .turn-indicator {
      font-size: 2rem;
      color: var(--azul-claro);
      text-align: center;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 15px 0;
    }

    .stored-cards {
      background: var(--amarillo);
      color: #000;
      padding: 15px;
      border-radius: 15px;
      min-height: 80px;
      width: 100%;
      text-align: center;
    }

    .card-tag {
      display: inline-block;
      background: white;
      color: #000;
      padding: 8px 15px;
      margin: 5px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .card-tag:hover {
      background: var(--cian);
    }

    .tokens-area {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
    }

    .token {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: var(--gris);
      transition: all 0.3s;
    }

    .token.revealed.pink { background: var(--rosa); }
    .token.revealed.brown { background: #b5651d; }
    .token.revealed.yellow { background: var(--amarillo); }

    .exit-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #ff4444;
      color: white;
    }

    /* Modales */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      color: #000;
      padding: 25px;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5rem;
      cursor: pointer;
      color: #aaa;
    }

    .shop-item {
      background: #f0f0f0;
      padding: 15px;
      margin: 10px 0;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .fish-token {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--gris);
      margin: 8px;
      cursor: pointer;
      border: 3px solid transparent;
    }

    .fish-token.selected {
      border: 3px solid var(--cian);
      transform: scale(1.1);
    }

    .message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--cian);
      color: #000;
      padding: 12px 25px;
      border-radius: 15px;
      font-weight: bold;
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .message.show {
      opacity: 1;
    }

    /* Ranking */
    .ranking-list {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      width: 100%;
    }

    .ranking-item {
      padding: 10px;
      margin: 8px 0;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      font-size: 1.3rem;
    }

    .winner {
      color: var(--amarillo);
      font-weight: bold;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <div id="main-container" class="container">
    <!-- Pantalla Menú -->
    <div id="menu-screen" class="screen active">
      <img src="https://via.placeholder.com/300x200/ee4cb7/ffffff?text=AXOLOTL+PANIC" alt="Logo" class="logo">
      <h1>AXOLOTL PANIC<br>DELUXE EDITION</h1>
      <button id="btn-play">JUGAR</button>
      <button id="btn-tutorial">TUTORIAL</button>
      <button id="btn-credits">CRÉDITOS</button>
      <button id="btn-exit">SALIR</button>
    </div>

    <!-- Pantalla Tutorial -->
    <div id="tutorial-screen" class="screen">
      <h1>TUTORIAL</h1>
      <div style="background:white;color:#000;padding:20px;border-radius:15px;margin:20px;">
        <p><strong>¡Bienvenido a AXOLOTL PANIC!</strong></p>
        <p>Recoge cartas, acumula basura y compra objetos para ganar puntos.</p>
        <p>Pesca fichas de ajolote para sumar 0.5, 1 o 1.5 puntos.</p>
        <p>Usa cartas especiales para robar, desafiar o invertir el juego.</p>
        <p>¡El que tenga más puntos al final gana!</p>
        <p>Tienes 8 segundos por turno. ¡No te duermas!</p>
      </div>
      <button id="back-to-menu1">Volver al Menú</button>
    </div>

    <!-- Pantalla Créditos -->
    <div id="credits-screen" class="screen">
      <h1>CRÉDITOS</h1>
      <div style="background:white;color:#000;padding:20px;border-radius:15px;margin:20px;">
        <p><strong>Desarrollado por:</strong> Tu Nombre</p>
        <p><strong>Arte:</strong> Axolotl Team</p>
        <p><strong>Música:</strong> Panic Sounds Inc.</p>
        <p><strong>Idea original:</strong> Un axolotl en pánico</p>
      </div>
      <button id="back-to-menu2">Volver al Menú</button>
    </div>

    <!-- Pantalla Juego -->
    <div id="gameplay-screen" class="screen">
      <button class="exit-btn" id="exit-to-menu">Salir al Menú</button>

      <!-- Info Jugadores -->
      <div class="player-info">
        <div class="player-box human" id="player-0">
          <strong>Tu</strong><br>
          Basura: <span id="p0-trash">0</span><br>
          Puntaje: <span id="p0-score">0</span><br>
          Fichas: <span id="p0-tokens"></span><br>
          Cartas: <span id="p0-cards">0</span>
        </div>
        <div class="player-box bot" id="player-1">
          <strong>Bot 1</strong><br>
          Basura: <span id="p1-trash">0</span><br>
          Puntaje: <span id="p1-score">0</span><br>
          Fichas: <span id="p1-tokens"></span><br>
          Cartas: <span id="p1-cards">0</span>
        </div>
        <div class="player-box bot" id="player-2">
          <strong>Bot 2</strong><br>
          Basura: <span id="p2-trash">0</span><br>
          Puntaje: <span id="p2-score">0</span><br>
          Fichas: <span id="p2-tokens"></span><br>
          Cartas: <span id="p2-cards">0</span>
        </div>
        <div class="player-box bot" id="player-3">
          <strong>Bot 3</strong><br>
          Basura: <span id="p3-trash">0</span><br>
          Puntaje: <span id="p3-score">0</span><br>
          Fichas: <span id="p3-tokens"></span><br>
          Cartas: <span id="p3-cards">0</span>
        </div>
      </div>

      <!-- Indicador de Turno -->
      <div class="turn-indicator" id="turn-indicator">Turno de: Tu</div>

      <!-- Botones de Acción -->
      <div class="action-buttons" id="action-buttons">
        <button id="btn-draw" class="btn-rosa">Recoger Carta Nueva</button>
        <button id="btn-apply" style="display:none">Aplicar Carta Nueva</button>
        <button id="btn-store" style="display:none">Almacenar Carta Nueva</button>
        <button id="btn-end-turn" style="display:none" class="btn-amarillo">Finalizar Turno</button>
        <button id="btn-shop">Ir a La Tiendita</button>
      </div>

      <!-- Cartas Almacenadas -->
      <div class="stored-cards">
        <strong>Cartas Almacenadas (Haz clic para usar):</strong>
        <div id="stored-cards-container"></div>
      </div>

      <!-- Fichas de Ajolotes -->
      <div>
        <h3>Fichas de Ajolotes</h3>
        <div class="tokens-area" id="tokens-area"></div>
      </div>
    </div>

    <!-- Pantalla Ranking -->
    <div id="ranking-screen" class="screen">
      <h1>¡JUEGO TERMINADO!</h1>
      <div class="ranking-list" id="ranking-list"></div>
      <button id="back-to-menu3">Volver al Menú</button>
    </div>
  </div>

  <!-- Mensaje Flotante -->
  <div id="message" class="message"></div>

  <!-- Modal Tienda -->
  <div id="shop-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="close-shop">&times;</span>
      <h2>La Tiendita</h2>
      <div id="shop-items">
        <div class="shop-item">
          <div>
            <strong>Comida +1</strong><br>
            Costo: 5 basura | +1 punto
          </div>
          <button id="buy-1">Comprar</button>
        </div>
        <div class="shop-item">
          <div>
            <strong>Comida +2</strong><br>
            Costo: 10 basura | +2 puntos
          </div>
          <button id="buy-2">Comprar</button>
        </div>
        <div class="shop-item">
          <div>
            <strong>Comida +3</strong><br>
            Costo: 15 basura | +4 puntos
          </div>
          <button id="buy-3">Comprar</button>
        </div>
      </div>
      <button id="exit-shop">Salir</button>
    </div>
  </div>

  <!-- Modal Pescar -->
  <div id="fish-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="close-fish">&times;</span>
      <h2>Hora de Pescar</h2>
      <p>Elige una ficha:</p>
      <div style="display:flex;justify-content:center;flex-wrap:wrap;" id="fish-tokens"></div>
      <button id="confirm-fish" disabled>Aceptar</button>
    </div>
  </div>

  <!-- Modal Elegir Jugador -->
  <div id="target-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="close-target">&times;</span>
      <h2>Elige al rival</h2>
      <div id="target-players"></div>
      <button id="confirm-target">Aceptar</button>
    </div>
  </div>

  <script>
    // === ESTADO DEL JUEGO ===
    const players = [
      { name: "Tu", isHuman: true, trash: 0, score: 0, tokens: [], cards: [], skipNext: false },
      { name: "Bot 1", isHuman: false, trash: 0, score: 0, tokens: [], cards: [], skipNext: false },
      { name: "Bot 2", isHuman: false, trash: 0, score: 0, tokens: [], cards: [], skipNext: false },
      { name: "Bot 3", isHuman: false, trash: 0, score: 0, tokens: [], cards: [], skipNext: false }
    ];

    let currentPlayer = 0;
    let turnCount = 0;
    const maxTurns = 30;
    let direction = 1; // 1 = normal, -1 = invertido
    let deck = [];
    let discarded = [];
    let availableTokens = Array(12).fill(null); // null = no revelada
    let currentCard = null;
    let timer = null;
    let botTimer = null;

    // Cartas
    const cardTypes = [
      { name: "Basura +1", type: "trash", value: 1 },
      { name: "Basura +2", type: "trash", value: 2 },
      { name: "Basura +3", type: "trash", value: 3 },
      { name: "Robo-Basura", type: "steal" },
      { name: "Hora de Pescar", type: "fish" },
      { name: "Intercambio de Ajolotes", type: "swap" },
      { name: "Duelo de Perder Turno", type: "skip" },
      { name: "Rotación de Basura", type: "rotate" },
      { name: "Cambio de Rotación de Turnos", type: "reverse" }
    ];

    // Inicializar mazo
    function initDeck() {
      deck = [];
      for (let i = 0; i < 5; i++) {
        cardTypes.forEach(card => deck.push({ ...card }));
      }
      shuffle(deck);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Fichas: 4 de cada tipo
    function initTokens() {
      const types = ['pink', 'brown', 'yellow'];
      const values = { pink: 0.5, brown: 1, yellow: 1.5 };
      availableTokens = [];
      types.forEach(type => {
        for (let i = 0; i < 4; i++) {
          availableTokens.push({ type, value: values[type], revealed: false });
        }
      });
      shuffle(availableTokens);
    }

    // === UI ===
    const screens = {
      menu: document.getElementById("menu-screen"),
      tutorial: document.getElementById("tutorial-screen"),
      credits: document.getElementById("credits-screen"),
      gameplay: document.getElementById("gameplay-screen"),
      ranking: document.getElementById("ranking-screen")
    };

    function showScreen(id) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      screens[id].classList.add("active");
      document.querySelector('.container').classList.add('active');
    }

    // === EVENTOS MENÚ ===
    document.getElementById("btn-play").onclick = () => {
      initGame();
      showScreen("gameplay");
      startTurn();
    };

    document.getElementById("btn-tutorial").onclick = () => showScreen("tutorial");
    document.getElementById("btn-credits").onclick = () => showScreen("credits");
    document.getElementById("back-to-menu1").onclick = 
    document.getElementById("back-to-menu2").onclick = 
    document.getElementById("back-to-menu3").onclick = () => showScreen("menu");

    document.getElementById("btn-exit").onclick = () => {
      if (confirm("¿Seguro que quieres salir?")) window.close();
    };

    document.getElementById("exit-to-menu").onclick = () => {
      if (confirm("¿Volver al menú? Se perderá la partida.")) {
        showScreen("menu");
      }
    };

    // === INICIO JUEGO ===
    function initGame() {
      players.forEach(p => {
        p.trash = 0; p.score = 0; p.tokens = []; p.cards = []; p.skipNext = false;
      });
      currentPlayer = 0;
      turnCount = 0;
      direction = 1;
      currentCard = null;
      initDeck();
      initTokens();
      updateUI();
      renderTokens();
    }

    function updateUI() {
      // Info jugadores
      players.forEach((p, i) => {
        document.getElementById(`p${i}-trash`).textContent = p.trash;
        document.getElementById(`p${i}-score`).textContent = p.score;
        document.getElementById(`p${i}-tokens`).textContent = p.tokens.map(t => t.value).join(", ") || "-";
        document.getElementById(`p${i}-cards`).textContent = p.cards.length;
        const box = document.getElementById(`player-${i}`);
        box.classList.toggle("current-turn", i === currentPlayer);
      });

      // Indicador de turno
      document.getElementById("turn-indicator").textContent = 
        `Turno de: ${players[currentPlayer].name} ${players[currentPlayer].skipNext ? "(Salta turno)" : ""}`;

      // Cartas almacenadas
      const container = document.getElementById("stored-cards-container");
      container.innerHTML = "";
      if (players[0].isHuman) {
        players[0].cards.forEach((card, idx) => {
          const tag = document.createElement("span");
          tag.className = "card-tag";
          tag.textContent = card.name;
          tag.onclick = () => useStoredCard(idx);
          container.appendChild(tag);
        });
      }

      // Botones
      const isHuman = players[currentPlayer].isHuman;
      document.getElementById("btn-draw").style.display = isHuman && !currentCard ? "block" : "none";
      document.getElementById("btn-apply").style.display = isHuman && currentCard ? "block" : "none";
      document.getElementById("btn-store").style.display = isHuman && currentCard && players[0].cards.length < 5 ? "block" : "none";
      document.getElementById("btn-end-turn").style.display = isHuman && currentCard ? "block" : "none";
    }

    function renderTokens() {
      const area = document.getElementById("tokens-area");
      area.innerHTML = "";
      players.forEach(p => {
        p.tokens.forEach(t => {
          const div = document.createElement("div");
          div.className = `token revealed ${t.type}`;
          area.appendChild(div);
        });
      });
      for (let i = players.reduce((a,p) => a + p.tokens.length, 0); i < 12; i++) {
        const div = document.createElement("div");
        div.className = "token";
        area.appendChild(div);
      }
    }

    // === TURNO ===
    function startTurn() {
      if (players[currentPlayer].skipNext) {
        showMessage(`${players[currentPlayer].name} pierde su turno.`);
        players[currentPlayer].skipNext = false;
        endTurn();
        return;
      }

      updateUI();

      if (!players[currentPlayer].isHuman) {
        botTimer = setTimeout(botPlay, 5000);
      } else {
        startPlayerTimer();
      }
    }

    function startPlayerTimer() {
      let timeLeft = 8;
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          showMessage("Tu perdiste tu turno por inactividad");
          endTurn();
        }
      }, 1000);
    }

    function clearTimers() {
      if (timer) clearInterval(timer);
      if (botTimer) clearTimeout(botTimer);
    }

    // === ACCIONES JUGADOR ===
    document.getElementById("btn-draw").onclick = () => {
      clearTimers();
      drawCard();
    };

    function drawCard() {
      if (deck.length === 0) {
        deck = discarded;
        discarded = [];
        shuffle(deck);
      }
      currentCard = deck.pop();
      showMessage(`Sacaste: ${currentCard.name}`);
      updateUI();
    }

    document.getElementById("btn-apply").onclick = () => {
      clearTimers();
      applyCard(currentCard);
      currentCard = null;
      document.getElementById("btn-end-turn").style.display = "block";
    };

    document.getElementById("btn-store").onclick = () => {
      clearTimers();
      if (players[0].cards.length >= 5) {
        showMessage("¡Máximo 5 cartas!");
        return;
      }
      players[0].cards.push(currentCard);
      showMessage(`Almacenaste: ${currentCard.name}`);
      currentCard = null;
      updateUI();
    };

    function useStoredCard(index) {
      clearTimers();
      const card = players[0].cards.splice(index, 1)[0];
      applyCard(card);
      endTurn();
    }

    document.getElementById("btn-end-turn").onclick = () => {
      clearTimers();
      endTurn();
    };

    // === TIENDA ===
    document.getElementById("btn-shop").onclick = openShop;
    document.getElementById("close-shop").onclick = 
    document.getElementById("exit-shop").onclick = () => {
      document.getElementById("shop-modal").classList.remove("active");
      if (players[currentPlayer].isHuman) endTurn();
    };

    function openShop() {
      if (!players[currentPlayer].isHuman) return;
      const modal = document.getElementById("shop-modal");
      modal.classList.add("active");

      const costs = [5, 10, 15];
      const points = [1, 2, 4];
      costs.forEach((cost, i) => {
        const btn = document.getElementById(`buy-${i+1}`);
        btn.disabled = players[0].trash < cost;
        btn.onclick = () => buyItem(cost, points[i], i+1);
      });
    }

    function buyItem(cost, pts, id) {
      if (players[0].trash < cost) return;
      players[0].trash -= cost;
      players[0].score += pts;
      showMessage(`¡Compraste Comida +${id}! +${pts} puntos`);
      updateUI();
      document.getElementById("shop-modal").classList.remove("active");
      endTurn();
    }

    // === APLICAR CARTA ===
    function applyCard(card) {
      switch (card.type) {
        case "trash":
          players[currentPlayer].trash += card.value;
          showMessage(`+${card.value} basura`);
          break;
        case "steal":
          openTargetModal(target => {
            const roll = rollDice();
            const stolen = Math.min(roll, players[target].trash);
            players[target].trash -= stolen;
            players[currentPlayer].trash += stolen;
            showMessage(`¡Robaste ${stolen} basura!`);
            updateUI();
          });
          break;
        case "fish":
          openFishModal();
          break;
        case "swap":
          openTargetModal(target => {
            const myRoll = rollDice();
            const theirRoll = rollDice();
            if (myRoll > theirRoll && players[target].tokens.length > 0) {
              const idx = Math.floor(Math.random() * players[target].tokens.length);
              const token = players[target].tokens.splice(idx, 1)[0];
              players[currentPlayer].tokens.push(token);
              players[currentPlayer].score += token.value;
              players[target].score -= token.value;
              showMessage(`¡Intercambiaste una ficha! +${token.value} puntos`);
            } else {
              showMessage(myRoll > theirRoll ? "No tiene fichas" : "¡Perdiste el intercambio!");
            }
            updateUI();
            renderTokens();
          });
          break;
        case "skip":
          openTargetModal(target => {
            const myRoll = rollDice();
            const theirRoll = rollDice();
            if (myRoll > theirRoll) {
              players[target].skipNext = true;
              showMessage(`¡${players[target].name} pierde su próximo turno!`);
            } else {
              players[currentPlayer].skipNext = true;
              showMessage("¡Tú pierdes tu próximo turno!");
            }
          });
          break;
        case "rotate":
          const trashes = players.map(p => p.trash);
          players.forEach((p, i) => {
            const prev = (i - direction + 4) % 4;
            p.trash = trashes[prev];
          });
          showMessage("¡Basura rotada!");
          break;
        case "reverse":
          direction *= -1;
          showMessage("¡Orden de turnos invertido!");
          break;
      }
      discarded.push(card);
      updateUI();
      renderTokens();
    }

    function rollDice() {
      return Math.floor(Math.random() * 6) + 1;
    }

    // === MODALES ===
    function openTargetModal(callback) {
      const modal = document.getElementById("target-modal");
      const container = document.getElementById("target-players");
      container.innerHTML = "";
      players.forEach((p, i) => {
        if (i === currentPlayer) return;
        const btn = document.createElement("button");
        btn.textContent = p.name;
        btn.onclick = () => {
          modal.classList.remove("active");
          callback(i);
        };
        container.appendChild(btn);
      });
      document.getElementById("confirm-target").onclick = () => modal.classList.remove("active");
      modal.classList.add("active");
    }

    function openFishModal() {
      const modal = document.getElementById("fish-modal");
      const container = document.getElementById("fish-tokens");
      container.innerHTML = "";
      let selected = null;

      availableTokens.forEach((token, i) => {
        if (token.revealed) return;
        const div = document.createElement("div");
        div.className = "fish-token";
        div.onclick = () => {
          document.querySelectorAll(".fish-token").forEach(d => d.classList.remove("selected"));
          div.classList.add("selected");
          selected = i;
          document.getElementById("confirm-fish").disabled = false;
        };
        container.appendChild(div);
      });

      document.getElementById("confirm-fish").onclick = () => {
        if (selected === null) return;
        const token = availableTokens[selected];
        token.revealed = true;
        players[currentPlayer].tokens.push(token);
        players[currentPlayer].score += token.value;
        showMessage(`¡Pescaste una ficha ${token.type === 'pink' ? 'rosa' : token.type === 'brown' ? 'café' : 'amarilla'} +${token.value} puntos!`);
        modal.classList.remove("active");
        renderTokens();
        updateUI();
      };

      document.getElementById("close-fish").onclick = () => modal.classList.remove("active");
      modal.classList.add("active");
    }

    // === BOT ===
    function botPlay() {
      const bot = players[currentPlayer];
      // Estrategia simple
      if (bot.cards.length >= 5) {
        const card = bot.cards.shift();
        applyBotCard(card);
      } else if (bot.trash >= 15 && getLeader().score > bot.score + 5) {
        // Comprar en tienda
        const costs = [5,10,15];
        const points = [1,2,4];
        let bought = false;
        for (let i = costs.length - 1; i >= 0; i--) {
          if (bot.trash >= costs[i]) {
            bot.trash -= costs[i];
            bot.score += points[i];
            showMessage(`${bot.name} compró en la tiendita`);
            bought = true;
            break;
          }
        }
        if (!bought) drawBotCard();
      } else {
        drawBotCard();
      }
      setTimeout(endTurn, 2000);
    }

    function drawBotCard() {
      if (deck.length === 0) {
        deck = discarded;
        discarded = [];
        shuffle(deck);
      }
      const card = deck.pop();
      if (card.type === "trash" || (bot.cards.length < 3 && Math.random() < 0.7)) {
        bot.cards.push(card);
      } else {
        applyBotCard(card);
      }
    }

    function applyBotCard(card) {
      // Implementar lógica de bot para cada carta
      // Simplificado: aplica si es posible
      showMessage(`${players[currentPlayer].name} usó ${card.name}`);
      discarded.push(card);
    }

    function getLeader() {
      return players.reduce((a,b) => a.score > b.score ? a : b);
    }

    // === FIN TURNO ===
    function endTurn() {
      clearTimers();
      currentPlayer = (currentPlayer + direction + 4) % 4;
      turnCount++;
      if (turnCount >= maxTurns || availableTokens.every(t => t.revealed)) {
        endGame();
      } else {
        setTimeout(startTurn, 800);
      }
    }

    // === FIN JUEGO ===
    function endGame() {
      clearTimers();
      const sorted = [...players].sort((a,b) => b.score - a.score);
      const list = document.getElementById("ranking-list");
      list.innerHTML = "";
      sorted.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "ranking-item";
        if (i === 0) div.classList.add("winner");
        div.innerHTML = `<strong>${i+1}. ${p.name}</strong> — ${p.score} puntos`;
        list.appendChild(div);
      });
      showScreen("ranking");
    }

    // === UTILIDADES ===
    function showMessage(text) {
      const msg = document.getElementById("message");
      msg.textContent = text;
      msg.classList.add("show");
      setTimeout(() => msg.classList.remove("show"), 3000);
    }

    // Inicializar
    document.querySelector('.container').classList.add('active');
  </script>
</body>
</html>